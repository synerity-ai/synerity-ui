<div [class]="containerClasses">
  <!-- Label -->
  <label *ngIf="label" 
         [for]="label"
         class="block text-sm font-medium text-gray-700 mb-1">
    {{ label }}
    <span *ngIf="required" class="text-red-500 ml-1">*</span>
  </label>

  <!-- Input Container -->
  <div class="relative">
    <!-- Prefix -->
    <div *ngIf="prefix" 
         class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
      <span class="text-gray-500 text-sm">{{ prefix }}</span>
    </div>

    <!-- Input Field -->
    <input
      [type]="inputType"
      [value]="value"
      [placeholder]="placeholder"
      [disabled]="disabled"
      [readonly]="readonly"
      [required]="required"
      [attr.maxlength]="maxlength"
      [attr.minlength]="minlength"
      [attr.pattern]="pattern"
      [attr.autocomplete]="autocomplete"
      [attr.autofocus]="autofocus"
      [attr.spellcheck]="spellcheck"
      [class]="inputClasses"
      [class.pl-10]="prefix"
      [class.pr-10]="suffix || clearable || (type === 'password' && showPasswordToggle)"
      (input)="onInput($event)"
      (blur)="onBlur($event)"
      (focus)="onFocus($event)"
      [attr.aria-invalid]="validationState === 'invalid'"
      [attr.aria-describedby]="(errorMessage || helperText) ? (label + '-description') : null"
      role="textbox"
      tabindex="0">

    <!-- Suffix / Clear Button / Password Toggle -->
    <div class="absolute inset-y-0 right-0 flex items-center pr-3">
      <!-- Clear Button -->
      <button *ngIf="clearable && hasValue && !disabled && !readonly"
              type="button"
              (click)="onClear()"
              class="text-gray-400 hover:text-gray-600 focus:outline-none focus:text-gray-600"
              aria-label="Clear input">
        <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>

      <!-- Password Toggle -->
      <button *ngIf="type === 'password' && showPasswordToggle && !disabled && !readonly"
              type="button"
              (click)="togglePasswordVisibility()"
              class="text-gray-400 hover:text-gray-600 focus:outline-none focus:text-gray-600"
              [attr.aria-label]="showPassword ? 'Hide password' : 'Show password'">
        <svg *ngIf="!showPassword" class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
        </svg>
        <svg *ngIf="showPassword" class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.878 9.878L3 3m6.878 6.878L21 21"></path>
        </svg>
      </button>

      <!-- Suffix -->
      <span *ngIf="suffix" class="text-gray-500 text-sm">{{ suffix }}</span>
    </div>
  </div>

  <!-- Helper Text / Error Message -->
  <div *ngIf="errorMessage || helperText" 
       [id]="label + '-description'"
       class="mt-1 text-sm"
       [class.text-red-600]="validationState === 'invalid'"
       [class.text-gray-500]="validationState !== 'invalid'">
    {{ errorMessage || helperText }}
  </div>
</div>

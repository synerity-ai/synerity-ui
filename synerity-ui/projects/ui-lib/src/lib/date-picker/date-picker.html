<div [class]="getComponentClass()" [style]="style" #datePickerContainer>
  
  <!-- Trigger Element -->
  <div 
    [class]="getTriggerClass()"
    (click)="toggle()"
    (focus)="onInputFocus()"
    (blur)="onInputBlur()"
    [attr.tabindex]="disabled ? -1 : 0"
    [attr.aria-expanded]="isOpen"
    [attr.aria-haspopup]="true"
    [attr.aria-label]="placeholder"
    role="button"
    #triggerElement>
    
    <!-- Input Field (for form integration) -->
    <input
      #dateInput
      type="text"
      [value]="getDisplayValue()"
      [placeholder]="placeholder"
      [disabled]="disabled"
      [readonly]="readonly"
      (input)="onInputChange($event)"
      (focus)="onInputFocus()"
      (blur)="onInputBlur()"
      class="sui-date-picker-input"
      [attr.aria-label]="placeholder"
      autocomplete="off">
    
    <!-- Calendar Icon -->
    <div class="sui-date-picker-icon" *ngIf="!readonly">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
        <line x1="16" y1="2" x2="16" y2="6"/>
        <line x1="8" y1="2" x2="8" y2="6"/>
        <line x1="3" y1="10" x2="21" y2="10"/>
      </svg>
    </div>
    
    <!-- Clear Button -->
    <button
      *ngIf="value && !disabled && !readonly && showClearButton"
      type="button"
      class="sui-date-picker-clear"
      (click)="clear($event)"
      [attr.aria-label]="'Clear date'">
      <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <line x1="18" y1="6" x2="6" y2="18"/>
        <line x1="6" y1="6" x2="18" y2="18"/>
      </svg>
    </button>
  </div>

  <!-- Calendar Panel -->
  <div
    *ngIf="isOpen && variant !== 'inline'"
    [class]="getCalendarClass()"
    [style]="getCalendarStyle()"
    role="dialog"
    [attr.aria-label]="'Date picker calendar'"
    #calendarPanel>
    
    <!-- Calendar Header -->
    <div class="sui-date-picker-header">
      <!-- Month/Year Navigation -->
      <div class="sui-date-picker-nav">
        <button
          type="button"
          class="sui-date-picker-nav-button"
          (click)="previousMonth()"
          [attr.aria-label]="'Previous month'">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="15,18 9,12 15,6"></polyline>
          </svg>
        </button>
        
        <button
          type="button"
          class="sui-date-picker-month-year"
          (click)="currentView = currentView === 'months' ? 'calendar' : 'months'"
          [attr.aria-label]="'Select month'">
          {{ monthNames[currentMonth] }}
        </button>
        
        <button
          type="button"
          class="sui-date-picker-month-year"
          (click)="currentView = currentView === 'years' ? 'calendar' : 'years'"
          [attr.aria-label]="'Select year'">
          {{ currentYear }}
        </button>
        
        <button
          type="button"
          class="sui-date-picker-nav-button"
          (click)="nextMonth()"
          [attr.aria-label]="'Next month'">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="9,18 15,12 9,6"></polyline>
          </svg>
        </button>
      </div>
    </div>

    <!-- Calendar Views -->
    <div class="sui-date-picker-content">
      
      <!-- Month Selection View -->
      <div *ngIf="currentView === 'months'" class="sui-date-picker-months">
        <div class="sui-date-picker-month-grid">
          <button
            *ngFor="let month of monthNames; let i = index"
            type="button"
            class="sui-date-picker-month"
            [class.sui-date-picker-month-selected]="i === currentMonth"
            (click)="goToMonth(i)"
            [attr.aria-label]="month">
            {{ month }}
          </button>
        </div>
      </div>

      <!-- Year Selection View -->
      <div *ngIf="currentView === 'years'" class="sui-date-picker-years">
        <div class="sui-date-picker-year-grid">
          <button
            *ngFor="let year of yearRange"
            type="button"
            class="sui-date-picker-year"
            [class.sui-date-picker-year-selected]="year === currentYear"
            (click)="goToYear(year)"
            [attr.aria-label]="year.toString()">
            {{ year }}
          </button>
        </div>
      </div>

      <!-- Calendar View -->
      <div *ngIf="currentView === 'calendar'" class="sui-date-picker-calendar-view">
        
        <!-- Week Days Header -->
        <div class="sui-date-picker-weekdays">
          <div
            *ngFor="let day of weekDays"
            class="sui-date-picker-weekday">
            {{ day }}
          </div>
        </div>

        <!-- Calendar Days -->
        <div class="sui-date-picker-days">
          <button
            *ngFor="let day of getCalendarDays()"
            type="button"
            class="sui-date-picker-day"
            [class.sui-date-picker-day-other-month]="!day.isCurrentMonth"
            [class.sui-date-picker-day-today]="day.isToday"
            [class.sui-date-picker-day-selected]="day.isSelected"
            [class.sui-date-picker-day-disabled]="day.isDisabled"
            [class.sui-date-picker-day-weekend]="day.isWeekend"
            [disabled]="day.isDisabled"
            (mousedown)="selectDate(day.date, $event)"
            [attr.aria-label]="day.date.toLocaleDateString()"
            [attr.aria-selected]="day.isSelected">
            {{ day.day }}
          </button>
        </div>

        <!-- Week Numbers (if enabled) -->
        <div *ngIf="showWeekNumbers" class="sui-date-picker-week-numbers">
          <div
            *ngFor="let day of getCalendarDays() | slice:0:6"
            class="sui-date-picker-week-number">
            {{ day.weekNumber }}
          </div>
        </div>
      </div>
    </div>

    <!-- Calendar Footer -->
    <div class="sui-date-picker-footer" *ngIf="showTodayButton || showClearButton">
      <button
        *ngIf="showTodayButton"
        type="button"
        class="sui-date-picker-today"
        (click)="selectToday()"
        [attr.aria-label]="'Select today'">
        Today
      </button>
      
      <button
        *ngIf="showClearButton"
        type="button"
        class="sui-date-picker-clear-footer"
        (click)="clear()"
        [attr.aria-label]="'Clear selection'">
        Clear
      </button>
    </div>

    <!-- Time Picker (if enabled) -->
    <div *ngIf="showTime && currentView === 'calendar'" class="sui-date-picker-time">
      <div class="sui-date-picker-time-inputs">
        <div class="sui-date-picker-time-input">
          <label>Hours</label>
          <input
            type="number"
            [value]="selectedTime.hours"
            (input)="selectedTime.hours = +$event.target.value"
            min="0"
            [max]="timeFormat === '24' ? 23 : 12"
            class="sui-date-picker-time-field">
        </div>
        
        <div class="sui-date-picker-time-separator">:</div>
        
        <div class="sui-date-picker-time-input">
          <label>Minutes</label>
          <input
            type="number"
            [value]="selectedTime.minutes"
            (input)="selectedTime.minutes = +$event.target.value"
            min="0"
            max="59"
            class="sui-date-picker-time-field">
        </div>
        
        <div *ngIf="timeFormat === '12'" class="sui-date-picker-time-input">
          <label>AM/PM</label>
          <select
            [value]="selectedTime.hours >= 12 ? 'PM' : 'AM'"
            (change)="onTimeFormatChange($event)"
            class="sui-date-picker-time-field">
            <option value="AM">AM</option>
            <option value="PM">PM</option>
          </select>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="w-full">
  <!-- Empty State -->
  <div *ngIf="value.length === 0" class="flex flex-col items-center justify-center py-12 px-4 text-center">
    <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mb-4">
      <svg class="w-8 h-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
      </svg>
    </div>
    <h3 class="text-lg font-medium text-gray-900 mb-2">No data available</h3>
    <p class="text-gray-500">{{ emptyMessage }}</p>
  </div>

  <!-- Tree Table -->
  <div *ngIf="value.length > 0" class="bg-white border border-gray-200 rounded-lg shadow-sm overflow-hidden">
    <div class="overflow-x-auto">
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
          <tr>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-12">
              <!-- Expand column -->
            </th>
            <th *ngFor="let col of columns"
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                [class.cursor-pointer]="col.sortable"
                [class.hover:bg-gray-100]="col.sortable"
                (click)="col.sortable ? onSortColumn(col) : null">
              <div class="flex items-center justify-between">
                <span class="flex-1">{{ col.header }}</span>
                <button *ngIf="col.sortable"
                        class="ml-2 p-1 text-gray-400 hover:text-gray-600 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-1 rounded"
                        (click)="onSortColumn(col)">
                  <svg class="w-4 h-4 transition-transform duration-200"
                       [class.rotate-180]="sortField === col.field && sortOrder === 'desc'"
                       fill="none"
                       stroke="currentColor"
                       viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"></path>
                  </svg>
                </button>
              </div>
            </th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
          <ng-container *ngFor="let node of value">
            <!-- Root Node Row -->
            <tr 
              class="transition-colors duration-150"
              [class.bg-primary-50]="isNodeSelected(node)"
              [class.cursor-pointer]="selectionMode"
              [class.hover:bg-gray-50]="selectionMode"
              [class.hover:bg-primary-100]="selectionMode && isNodeSelected(node)"
              (click)="onNodeClick(node, $event)">
              
              <!-- Expand Column -->
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="flex items-center">
                  <button
                    *ngIf="hasChildren(node)"
                    type="button"
                    (click)="toggleNode(node); $event.stopPropagation()"
                    class="flex items-center justify-center w-5 h-5 text-gray-400 hover:text-gray-600 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-1 rounded"
                  >
                    <svg class="w-3 h-3 transition-transform duration-200" 
                         [class.rotate-90]="node.expanded"
                         fill="none" 
                         stroke="currentColor" 
                         viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                    </svg>
                  </button>
                  <div *ngIf="!hasChildren(node)" class="w-5 h-5"></div>
                </div>
              </td>
              
              <!-- Data Columns -->
              <td *ngFor="let col of columns" class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                <div class="flex items-center">
                  <input
                    *ngIf="selectionMode === 'checkbox'"
                    type="checkbox"
                    [checked]="isNodeSelected(node)"
                    class="h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded mr-3"
                    (click)="$event.stopPropagation()"
                    (change)="onNodeClick(node, $event)"
                  />
                  <span class="flex-1">{{ getNodeValue(node, col.field) }}</span>
                </div>
              </td>
            </tr>
            
            <!-- Child Rows -->
            <tr *ngIf="hasChildren(node) && node.expanded" class="bg-gray-50">
              <td [attr.colspan]="columns.length + 1" class="px-6 py-2">
                <div class="ml-6 space-y-1">
                  <div *ngFor="let child of node.children" 
                       class="flex items-center p-2 rounded-md cursor-pointer transition-colors duration-150 hover:bg-gray-100"
                       [class.bg-primary-50]="isNodeSelected(child)"
                       (click)="onNodeClick(child, $event)">
                    
                    <!-- Child Expand Button -->
                    <button
                      *ngIf="hasChildren(child)"
                      type="button"
                      (click)="toggleNode(child); $event.stopPropagation()"
                      class="flex items-center justify-center w-5 h-5 mr-2 text-gray-400 hover:text-gray-600 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-1 rounded"
                    >
                      <svg class="w-3 h-3 transition-transform duration-200" 
                           [class.rotate-90]="child.expanded"
                           fill="none" 
                           stroke="currentColor" 
                           viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                      </svg>
                    </button>
                    <div *ngIf="!hasChildren(child)" class="w-5 h-5 mr-2"></div>
                    
                    <!-- Child Selection Checkbox -->
                    <input
                      *ngIf="selectionMode === 'checkbox'"
                      type="checkbox"
                      [checked]="isNodeSelected(child)"
                      class="h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded mr-2"
                      (click)="$event.stopPropagation()"
                      (change)="onNodeClick(child, $event)"
                    />
                    
                    <!-- Child Data -->
                    <span class="text-sm text-gray-900 flex-1">{{ getNodeValue(child, columns[0].field || '') || child.key }}</span>
                  </div>
                </div>
              </td>
            </tr>
          </ng-container>
        </tbody>
      </table>
    </div>
  </div>
</div>

<div class="sui-tree-table-wrapper">
  <!-- Empty State -->
  <div *ngIf="value.length === 0" class="sui-tree-table-empty">
    <div class="sui-tree-table-empty-icon">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
      </svg>
    </div>
    <h3 class="sui-tree-table-empty-title">No data available</h3>
    <p class="sui-tree-table-empty-message">{{ emptyMessage }}</p>
  </div>

  <!-- Tree Table -->
  <div *ngIf="value.length > 0" class="sui-tree-table-container">
    <div class="sui-tree-table-scroll">
      <table class="sui-tree-table">
        <thead class="sui-tree-table-thead">
          <tr>
            <th class="sui-tree-table-th sui-tree-table-th-toggle">
              <!-- Expand column -->
            </th>
            <th *ngFor="let col of columns"
                class="sui-tree-table-th"
                [class.sui-tree-table-th-sortable]="col.sortable"
                (click)="col.sortable ? onSortColumn(col) : null">
              <div class="sui-tree-table-th-content">
                <span class="sui-tree-table-th-label">{{ col.header }}</span>
                <button *ngIf="col.sortable"
                        class="sui-tree-table-sort-btn"
                        [class.sui-tree-table-sort-desc]="sortField === col.field && sortOrder === 'desc'"
                        (click)="onSortColumn(col)">
                  <svg class="sui-tree-table-sort-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"></path>
                  </svg>
                </button>
              </div>
            </th>
          </tr>
        </thead>
        <tbody class="sui-tree-table-tbody">
          <ng-container *ngFor="let node of value">
            <!-- Root Node Row -->
            <tr 
              class="sui-tree-table-row"
              [class.sui-tree-table-row-selected]="isNodeSelected(node)"
              [class.sui-tree-table-row-selectable]="selectionMode"
              (click)="onNodeClick(node, $event)">
              
              <!-- Expand Column -->
              <td class="sui-tree-table-td sui-tree-table-td-toggle">
                <div class="sui-tree-table-toggle-container">
                  <button
                    *ngIf="hasChildren(node)"
                    type="button"
                    (click)="toggleNode(node); $event.stopPropagation()"
                    class="sui-tree-table-toggle"
                    [class.sui-tree-table-toggle-expanded]="node.expanded"
                  >
                    <svg class="sui-tree-table-toggle-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                    </svg>
                  </button>
                  <div *ngIf="!hasChildren(node)" class="sui-tree-table-toggle-spacer"></div>
                </div>
              </td>
              
              <!-- Data Columns -->
              <td *ngFor="let col of columns" class="sui-tree-table-td">
                <div class="sui-tree-table-cell">
                  <input
                    *ngIf="selectionMode === 'checkbox'"
                    type="checkbox"
                    [checked]="isNodeSelected(node)"
                    class="sui-tree-table-checkbox"
                    (click)="$event.stopPropagation()"
                    (change)="onNodeClick(node, $event)"
                  />
                  <span class="sui-tree-table-cell-value">{{ getNodeValue(node, col.field) }}</span>
                </div>
              </td>
            </tr>
            
            <!-- Child Rows -->
            <tr *ngIf="hasChildren(node) && node.expanded" class="sui-tree-table-row-children">
              <td [attr.colspan]="columns.length + 1" class="sui-tree-table-td-children">
                <div class="sui-tree-table-children">
                  <div *ngFor="let child of node.children" 
                       class="sui-tree-table-child"
                       [class.sui-tree-table-child-selected]="isNodeSelected(child)"
                       (click)="onNodeClick(child, $event)">
                    
                    <!-- Child Expand Button -->
                    <button
                      *ngIf="hasChildren(child)"
                      type="button"
                      (click)="toggleNode(child); $event.stopPropagation()"
                      class="sui-tree-table-toggle"
                      [class.sui-tree-table-toggle-expanded]="child.expanded"
                    >
                      <svg class="sui-tree-table-toggle-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                      </svg>
                    </button>
                    <div *ngIf="!hasChildren(child)" class="sui-tree-table-toggle-spacer"></div>
                    
                    <!-- Child Selection Checkbox -->
                    <input
                      *ngIf="selectionMode === 'checkbox'"
                      type="checkbox"
                      [checked]="isNodeSelected(child)"
                      class="sui-tree-table-checkbox"
                      (click)="$event.stopPropagation()"
                      (change)="onNodeClick(child, $event)"
                    />
                    
                    <!-- Child Data -->
                    <span class="sui-tree-table-child-label">{{ getNodeValue(child, columns[0].field || '') || child.key }}</span>
                  </div>
                </div>
              </td>
            </tr>
          </ng-container>
        </tbody>
      </table>
    </div>
  </div>
</div>
